<div class="page-content">
  <h2>Polityka</h2>
  <div class="toast" *ngIf="message">{{ message }}</div>

  <div *ngIf="!loading; else loadingTpl">
    <!-- Twoja koalicja -->
    <div class="card" *ngIf="kingdom?.coalitionId">
      <h3>Twoja Koalicja: {{ kingdom?.coalitionName }}</h3>
      <p>Rola: <strong>{{ kingdom?.coalitionRole || 'Member' }}</strong></p>
      
      <!-- Członkowie koalicji -->
      <div class="members-section" *ngIf="coalitionMembers.length > 0">
        <h4>Członkowie:</h4>
        <div class="member-list">
          <div class="member-item" *ngFor="let member of coalitionMembers" [ngClass]="getMemberRoleClass(member.coalitionRole)">
            <span class="member-name">{{ member.name }}</span>
            <span class="member-role" *ngIf="member.coalitionRole !== 'Member'">{{ getRoleDisplay(member.coalitionRole) }}</span>
          </div>
        </div>
      </div>

      <!-- Zarządzanie Głównodowodzącym (dla Imperatora) -->
      <div class="commander-management" *ngIf="kingdom?.coalitionRole === 'Imperator'">
        <h4>Zarządzanie Głównodowodzącym</h4>
        <div class="form-row">
          <label>Mianuj Głównodowodzącego:</label>
          <select [(ngModel)]="selectedCommanderId">
            <option [value]="null">Wybierz księstwo...</option>
            <option *ngFor="let member of coalitionMembers"
                    [value]="member.id"
                    [disabled]="member.id === kingdom?.id || member.coalitionRole === 'MainCommander'">
              {{ member.name }} {{ member.coalitionRole === 'MainCommander' ? '(Głównodowodzący)' : '' }}
            </option>
          </select>
          <button class="btn-action" (click)="appointMainCommander()"
                  [disabled]="!selectedCommanderId">Mianuj</button>
        </div>
        <div *ngIf="currentMainCommander" class="current-commander">
          <p>Obecny Głównodowodzący: <strong>{{ currentMainCommander.name }}</strong></p>
          <button class="btn-danger" (click)="removeMainCommander()">Usuń z funkcji</button>
        </div>
      </div>

      <button class="btn-danger" (click)="leaveCoalition()">Opuść koalicję</button>
    </div>

    <!-- Utwórz koalicję -->
    <div class="card" *ngIf="!kingdom?.coalitionId">
      <h3>Utwórz nową koalicję</h3>
      <div class="create-form">
        <input type="text" [(ngModel)]="newName" placeholder="Nazwa koalicji" />
        <input type="text" [(ngModel)]="newTag" placeholder="Tag (max 10 znaków)" maxlength="10" />
        <button class="btn-action" (click)="createCoalition()">Utwórz</button>
      </div>
    </div>

    <!-- Lista koalicji -->
    <div class="card">
      <h3>Dostępne koalicje</h3>
      <div class="coalition-list">
        <div class="coalition-row header">
          <span>Nazwa</span><span>Tag</span><span>Lider</span><span>Członkowie</span><span>PSO</span><span></span>
        </div>
        <div class="coalition-row" *ngFor="let c of coalitions">
          <span class="name">{{ c.name }}</span>
          <span class="tag">[{{ c.tag }}]</span>
          <span>{{ c.leaderName || '-' }}</span>
          <span>{{ c.memberCount }}/{{ c.maxMembers }}</span>
          <span class="pso">{{ c.psoProgress }}%</span>
          <button class="btn-sm" *ngIf="!kingdom?.coalitionId && c.memberCount < c.maxMembers"
                  (click)="joinCoalition(c.id)">Dołącz</button>
        </div>
        <p *ngIf="coalitions.length === 0" class="empty">Brak koalicji.</p>
      </div>
    </div>
  </div>

  <ng-template #loadingTpl><div class="loading">Ładowanie...</div></ng-template>
</div>
